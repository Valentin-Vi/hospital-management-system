generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  email     String   @unique
  password  String
  lastname  String
  userId   Int      @id @unique @default(autoincrement())
  type      UserType @default(VISITOR)
  enabled   Boolean  @default(false)
  firstname String   @default("FirstName")
  admins    Admin?
  clients   Client?
  desks     Desk?
  doctors   Doctor?

  @@map("users")
}

model Client {
  clientId Int     @unique
  users     User    @relation(fields: [clientId], references: [userId])
  visits    Visit[]

  @@map("clients")
}

model Doctor {
  specialty String
  doctorId Int     @unique
  users     User    @relation(fields: [doctorId], references: [userId])
  visits    Visit[]

  @@map("doctors")
}

model Visit {
  visit_date    DateTime
  clientId     Int
  creation_date DateTime @default(now())
  doctorId     Int
  visitId      Int      @id @unique @default(autoincrement())
  clients       Client   @relation(fields: [clientId], references: [clientId])
  doctors       Doctor   @relation(fields: [doctorId], references: [doctorId])

  @@map("visits")
}

model Desk {
  deskId Int  @unique
  users   User @relation(fields: [deskId], references: [userId])

  @@map("desks")
}

model Admin {
  adminId Int  @unique
  users    User @relation(fields: [adminId], references: [userId])

  @@map("admins")
}

model Inventory {
  inventoryId      Int        @id @unique @default(autoincrement())
  medicationId     Int        @unique
  quantity         Int        @default(0)
  minimum_quantity Int        @default(0)
  medication       Medication @relation(fields: [medicationId], references: [medicationId])

  @@map("inventory")
}

model Batch {
  batchId        Int        @id @unique @default(autoincrement())
  medicationId   Int
  quantity       Int
  expiration_date DateTime
  medication     Medication @relation(fields: [medicationId], references: [medicationId])

  @@map("batches")
}

model Medication {
  medicationId   Int      @id @unique @default(autoincrement())
  name            String
  category        String
  brand_name      String
  generic_name    String
  strength        String
  form            String
  inventory       Inventory?
  batches         Batch[]

  @@map("medications")
}

enum UserType {
  VISITOR
  ADMIN
  CLIENT
  DOCTOR
  DESK

  @@map("user_type")
}
